rownames(phl_endpoints) <- phl_endpoints
View(phl_endpoints)
colnames(phl_endpoints) <- phl_categories
rownames(phl_endpoints) <- phl_subcategories
View(phl_endpoints)
?rownames
phl_endpoints[x == category, y == subcategory]
phl_endpoints[category, subcategory]
category <- phl_categories[1]
subcategory <- phl_subcategories[1]
phl_endpoints[category, subcategory]
rm(category, subcategory)
lapply(phl_categories, fx.phl_endpoints)
fx.phl_endpoints <- function(category, subcategory) {
phl_endpoints[category, subcategory] <- paste("covid", category, "by", subcategory, sep = "_")
}
lapply(phl_categories, fx.phl_endpoints)
?mapply
mapply(fx.phl_endpoints, phl_categories, phl_subcategories)
View(phl_endpoints)
phl_categories
fx.phl_endpoints <- function(x, y) {
phl_endpoints[x, y] <- paste("covid", x, "by", y, sep = "_")
}
mapply(fx.phl_endpoints, phl_categories, phl_subcategories)
mapply(fx.phl_endpoints, phl_categories, phl_subcategories, SIMPLIFY = "array")
phl_endpoints <- mapply(fx.phl_endpoints, phl_categories, phl_subcategories, SIMPLIFY = "array")
phl_endpoints <- mapply(fx.phl_endpoints, phl_categories, phl_subcategories, SIMPLIFY = FALSE)
phl_endpoints <-
data.frame(matrix(
ncol = length(phl_categories),
nrow = length(phl_subcategories)
))
colnames(phl_endpoints) <- phl_categories
rownames(phl_endpoints) <- phl_subcategories
fx.phl_endpoints <- function(x, y) {
phl_endpoints[x, y] <- paste("covid", x, "by", y, sep = "_")
}
phl_endpoints <- mapply(fx.phl_endpoints, phl_categories, phl_subcategories, SIMPLIFY = FALSE)
View(phl_endpoints)
View(phl_endpoints)
phl_endpoints <-
data.frame(matrix(
ncol = length(phl_categories),
nrow = length(phl_subcategories)
))
colnames(phl_endpoints) <- phl_categories
rownames(phl_endpoints) <- phl_subcategories
View(phl_endpoints)
rm(phl_categories, phl_subcategories, phl_endpoints)
phl_endpoints <- c(covid_cases_by_outcome
covid_cases_by_date
covid_cases_by_zip
covid_cases_by_age
covid_cases_by_sex
covid_cases_by_race
)
phl_endpoints <- c("covid_cases_by_outcome",
"covid_cases_by_date",
"covid_cases_by_zip",
"covid_cases_by_age",
"covid_cases_by_sex",
"covid_cases_by_race",
"covid_hospitalizations_by_date",
"covid_hospitalizations_by_zip",
"covid_hospitalizations_by_age",
"covid_hospitalizations_by_sex",
"covid_hospitalizations_by_race",
"covid_deaths_by_date",
"covid_deaths_by_zip",
"covid_deaths_by_age",
"covid_deaths_by_sex",
"covid_deaths_by_race")
fx.phl_endpoints(x) {
paste0(phl_carto, "SELECT * FROM ", x)
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints(x) {
paste0(phl_carto, "SELECT * FROM ", x)
}
fx.phl_endpoints(x) {
paste0(phl_carto, "SELECT * FROM ", x)
}
?url
proj_name <- "covid19"
pkgs <-
c("tidyverse",
"devtools",
"ggplot2",
"ggfortify",
"ggmap", # mapping
"gganimate",
"magick",
"RSocrata",
"jsonlite"
"reactable",
"zoo", # moving averages
"hrbrthemes", # themes for graphs
"socviz", # %nin%
"geofacet", # maps
"usmap" # lat and long
)
installed_packages <- pkgs %in%
rownames(installed.packages())
if (any(installed_packages == FALSE)) {
install.packages(pkgs[!installed_packages])
}
invisible(lapply(pkgs, library, character.only = TRUE))
proj_name <- "covid19"
pkgs <-
c("tidyverse",
"devtools",
"ggplot2",
"ggfortify",
"ggmap", # mapping
"gganimate",
"magick",
"RSocrata",
"jsonlite",
"reactable",
"zoo", # moving averages
"hrbrthemes", # themes for graphs
"socviz", # %nin%
"geofacet", # maps
"usmap" # lat and long
)
installed_packages <- pkgs %in%
rownames(installed.packages())
if (any(installed_packages == FALSE)) {
install.packages(pkgs[!installed_packages])
}
invisible(lapply(pkgs, library, character.only = TRUE))
proj_name <- "covid19"
pkgs <-
c("tidyverse",
"devtools",
"ggplot2",
"ggfortify",
"ggmap", # mapping
"gganimate",
"magick",
"RSocrata",
"jsonlite",
"sf"
"reactable",
"zoo", # moving averages
"hrbrthemes", # themes for graphs
"socviz", # %nin%
"geofacet", # maps
"usmap" # lat and long
)
installed_packages <- pkgs %in%
rownames(installed.packages())
if (any(installed_packages == FALSE)) {
install.packages(pkgs[!installed_packages])
}
invisible(lapply(pkgs, library, character.only = TRUE))
proj_name <- "covid19"
pkgs <-
c("tidyverse",
"devtools",
"ggplot2",
"ggfortify",
"ggmap", # mapping
"gganimate",
"magick",
"RSocrata",
"jsonlite",
"sf",
"reactable",
"zoo", # moving averages
"hrbrthemes", # themes for graphs
"socviz", # %nin%
"geofacet", # maps
"usmap" # lat and long
)
installed_packages <- pkgs %in%
rownames(installed.packages())
if (any(installed_packages == FALSE)) {
install.packages(pkgs[!installed_packages])
}
invisible(lapply(pkgs, library, character.only = TRUE))
fx.phl_endpoints(x) {
phl_query <- paste0(phl_carto, "SELECT * FROM ", x)
assign(x) <- fromJSON(url(phl_query))
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints(x) {
phl_query <- paste0(phl_carto, "SELECT * FROM ", x)
assign(x) <- fromJSON(url(phl_query))
}
fx.phl_endpoints <- function(x) {
phl_query <- paste0(phl_carto, "SELECT * FROM ", x)
assign(x) <- fromJSON(url(phl_query))
}
lapply(phl_endpoints, fx.phl_endpoints)
phl_carto <- "https://phl.carto.com/api/v2/sql?q="
phl_endpoints <- c("covid_cases_by_outcome",
"covid_cases_by_date",
"covid_cases_by_zip",
"covid_cases_by_age",
"covid_cases_by_sex",
"covid_cases_by_race",
"covid_hospitalizations_by_date",
"covid_hospitalizations_by_zip",
"covid_hospitalizations_by_age",
"covid_hospitalizations_by_sex",
"covid_hospitalizations_by_race",
"covid_deaths_by_date",
"covid_deaths_by_zip",
"covid_deaths_by_age",
"covid_deaths_by_sex",
"covid_deaths_by_race")
fx.phl_endpoints <- function(x) {
phl_query <- paste0(phl_carto, "SELECT * FROM ", x)
assign(x) <- fromJSON(url(phl_query))
}
lapply(phl_endpoints, fx.phl_endpoints)
rm(con)
phl_endpoints <- c("covid_cases_by_outcome",
"covid_cases_by_date",
"covid_cases_by_zip",
"covid_cases_by_age",
"covid_cases_by_sex",
"covid_cases_by_race",
"covid_hospitalizations_by_date",
"covid_hospitalizations_by_zip",
"covid_hospitalizations_by_age",
"covid_hospitalizations_by_sex",
"covid_hospitalizations_by_race",
"covid_deaths_by_date",
"covid_deaths_by_zip",
"covid_deaths_by_age",
"covid_deaths_by_sex",
"covid_deaths_by_race")
fx.phl_endpoints <- function(x) {
phl_query <- paste0(phl_carto, "SELECT * FROM ", x)
assign(x) <- fromJSON(url(phl_query))
}
lapply(phl_endpoints, fx.phl_endpoints)
phl_endpoints <- c("covid_cases_by_outcome",
"covid_cases_by_date",
"covid_cases_by_zip",
"covid_cases_by_age",
"covid_cases_by_sex",
"covid_cases_by_race",
"covid_hospitalizations_by_date",
"covid_hospitalizations_by_zip",
"covid_hospitalizations_by_age",
"covid_hospitalizations_by_sex",
"covid_hospitalizations_by_race",
"covid_deaths_by_date",
"covid_deaths_by_zip",
"covid_deaths_by_age",
"covid_deaths_by_sex",
"covid_deaths_by_race")
fx.phl_endpoints <- function(x) {
phl_query <- paste0(phl_carto, "SELECT * FROM ", x)
assign(x) <- fromJSON(url(phl_query))
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste0(phl_carto, "SELECT * FROM ", x)
assign(x) <- phl_query %>%
url() %>%
fromJSON()
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste0(phl_carto, "SELECT*FROM ", x)
assign(x) <- phl_query %>%
url() %>%
fromJSON()
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste0(phl_carto, "SELECT*FROM", x)
assign(x) <- phl_query %>%
url() %>%
fromJSON()
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste0(phl_carto, "SELECT%20%*%20%FROM%20%", x)
assign(x) <- phl_query %>%
url() %>%
fromJSON()
}
lapply(phl_endpoints, fx.phl_endpoints)
paste0(phl_carto, "SELECT * FROM ", "covid_cases_by_date")
paste0(phl_carto, "SELECT * FROM ", "covid_cases_by_date") %>%
url() %>%
fromJSON()
?curl
??curl
paste0(phl_carto, "SELECT * FROM ", "covid_cases_by_date") %>%
url() %>%
fromJSON()
paste(phl_carto, "SELECT", "*", "FROM", "covid_cases_by_date", sep = "%20") %>%
url() %>%
fromJSON()
paste(phl_carto, "SELECT", "*", "FROM", "covid_cases_by_date", sep = "%20")
fx.phl_endpoints <- function(x) {
phl_query <- paste0(phl_carto, "SELECT * FROM ", x)
assign(x) <- phl_query %>%
url() %>%
fromJSON()
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, , sep = "%20")
assign(x) <- phl_query %>%
url() %>%
fromJSON()
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
assign(x) <- phl_query %>%
url() %>%
fromJSON()
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
assign(x = x) <- phl_query %>%
url() %>%
fromJSON()
}
lapply(phl_endpoints, fx.phl_endpoints)
?assign
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
assign(x = x, phl_query %>%
url() %>%
fromJSON())
}
lapply(phl_endpoints, fx.phl_endpoints)
phl_endpoints <- c("covid_cases_by_outcome",
"covid_cases_by_date",
"covid_cases_by_zip",
"covid_cases_by_age",
"covid_cases_by_sex",
"covid_cases_by_race",
"covid_hospitalizations_by_date",
"covid_hospitalizations_by_zip",
"covid_hospitalizations_by_age",
"covid_hospitalizations_by_sex",
"covid_hospitalizations_by_race",
"covid_deaths_by_date",
"covid_deaths_by_zip",
"covid_deaths_by_age",
"covid_deaths_by_race")
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
assign(x = x, phl_query %>%
url() %>%
fromJSON())
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
assign(x, phl_query %>%
url() %>%
fromJSON())
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
assign(paste0("phl_", x), phl_query %>%
url() %>%
fromJSON())
}
lapply(phl_endpoints, fx.phl_endpoints)
?jsonlite
paste(phl_carto, "SELECT", "*", "FROM", "covid_cases_by_date", sep = "%20") %>%
url() %>%
fromJSON(flatten = TRUE)
df <- paste(phl_carto, "SELECT", "*", "FROM", "covid_cases_by_date", sep = "%20") %>%
url() %>%
fromJSON(flatten = TRUE)
View(df)
df <-
paste(phl_carto, "SELECT", "*", "FROM", "covid_cases_by_date", sep = "%20") %>%
url() %>%
fromJSON(
simplifyVector = TRUE,
simplifyDataFrame = simplifyVector,
simplifyMatrix = simplifyVector,
flatten = TRUE
)
df <-
paste(phl_carto, "SELECT", "*", "FROM", "covid_cases_by_date", sep = "%20") %>%
url() %>%
fromJSON(
simplifyVector = TRUE,
simplifyDataFrame = TRUE,
simplifyMatrix = TRUE,
flatten = TRUE
)
View(df)
View(df)
df$rows
df <- df$rows
View(df)
source('~/Documents/dev/GitHub/covid-19/init.R')
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
assign(
paste0("phl_", x),
phl_query %>%
url() %>%
fromJSON(
simplifyVector = TRUE,
simplifyDataFrame = TRUE,
simplifyMatrix = TRUE,
flatten = TRUE
)
)
}
lapply(phl_endpoints, fx.phl_endpoints)
x <- "covid_cases_by_date"
assign(
paste0("phl_", x),
phl_query %>%
url() %>%
fromJSON(
simplifyVector = TRUE,
simplifyDataFrame = TRUE,
simplifyMatrix = TRUE,
flatten = TRUE
)
)
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
assign(
paste0("phl_", x),
phl_query %>%
url() %>%
fromJSON(
simplifyVector = TRUE,
simplifyDataFrame = TRUE,
simplifyMatrix = TRUE,
flatten = TRUE
)
)
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
assign(
paste0("phl_", x),
phl_query %>%
url() %>%
fromJSON(
simplifyVector = TRUE,
simplifyDataFrame = TRUE,
simplifyMatrix = TRUE,
flatten = TRUE
)
) %>%
return()
}
lapply(phl_endpoints, fx.phl_endpoints)
?return
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
value_name <- paste0("phl_", x)
assign(
value_name,
phl_query %>%
url() %>%
fromJSON(
simplifyVector = TRUE,
simplifyDataFrame = TRUE,
simplifyMatrix = TRUE,
flatten = TRUE
)
)
return(value_name)
}
lapply(phl_endpoints, fx.phl_endpoints)
View(phl_covid_cases_by_date)
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
object_rds <- paste0("phl_", x, ".rds")
saveRDS(
phl_query %>%
url() %>%
fromJSON(
simplifyVector = TRUE,
simplifyDataFrame = TRUE,
simplifyMatrix = TRUE,
flatten = TRUE
),
object_rds
)
}
lapply(phl_endpoints, fx.phl_endpoints)
fx.phl_endpoints <- function(x) {
phl_query <- paste(phl_carto, "SELECT", "*", "FROM", x, sep = "%20")
query_rds <- paste0("data/","phl_", x, ".rds")
df <-
phl_query %>%
url() %>%
fromJSON(
simplifyVector = TRUE,
simplifyDataFrame = TRUE,
simplifyMatrix = TRUE,
flatten = TRUE
)
df <- df$rows
saveRDS(df, query_rds)
}
lapply(phl_endpoints, fx.phl_endpoints)
